<script>
const log=document.getElementById('log'),text=document.getElementById('text'),send=document.getElementById('send');
const messages=[{role:'system',content:'You are SoulSync, a caring, supportive companion.'}];

function add(c,me=false){
  const d=document.createElement('div');
  d.className='bubble '+(me?'me':'bot');
  d.textContent=c;
  log.appendChild(d);
  log.scrollTop=log.scrollHeight;
}

async function chatSend(t){
  if(!t) return;
  add(t,true); messages.push({role:'user',content:t});
  try{
    const r=await fetch('/api/chat',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({messages})
    });
    const data=await r.json();
    if(!r.ok || data.error){
      add('⚠️ '+(data.error || 'Server error'));  // show real error
      return;
    }
    const ans = data.answer || '(empty answer)';
    add(ans);
    messages.push({role:'assistant',content:ans});
  }catch(e){
    add('⚠️ Network error: '+e.message);
  }
}
send.onclick=()=>{ chatSend(text.value); text.value=''; };
</script>


